"use strict";(self.webpackChunkflowmap_gl_docs=self.webpackChunkflowmap_gl_docs||[]).push([[119],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var l=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,l,a=function(e,t){if(null==e)return{};var n,l,a={},r=Object.keys(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=l.createContext({}),u=function(e){var t=l.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return l.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},d=l.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=u(n),d=a,g=c["".concat(s,".").concat(d)]||c[d]||m[d]||r;return n?l.createElement(g,i(i({ref:t},p),{},{components:n})):l.createElement(g,i({ref:t},p))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:a,i[1]=o;for(var u=2;u<r;u++)i[u]=n[u];return l.createElement.apply(null,i)}return l.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1304:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var l=n(7462),a=(n(7294),n(3905));const r={sidebar_position:3},i="Clustering",o={unversionedId:"api/clustering",id:"api/clustering",title:"Clustering",description:"When visualizing large numbers of locations, flowmap.gl can cluster nearby points together. This improves performance and visual clarity by aggregating locations at different zoom levels.",source:"@site/docs/api/clustering.md",sourceDirName:"api",slug:"/api/clustering",permalink:"/docs/api/clustering",draft:!1,editUrl:"https://github.com/visgl/flowmap.gl-docs/docs/api/clustering.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"docsSidebar",previous:{title:"Color Schemes",permalink:"/docs/api/color-schemes"},next:{title:"TypeScript Types",permalink:"/docs/api/types"}},s={},u=[{value:"How Clustering Works",id:"how-clustering-works",level:2},{value:"Key Concepts",id:"key-concepts",level:3},{value:"Enabling Clustering",id:"enabling-clustering",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"<code>clusteringEnabled</code>",id:"clusteringenabled",level:3},{value:"<code>clusteringAuto</code>",id:"clusteringauto",level:3},{value:"<code>clusteringLevel</code>",id:"clusteringlevel",level:3},{value:"Cluster Levels Data Structure",id:"cluster-levels-data-structure",level:2},{value:"Example: Pre-computed Clusters",id:"example-pre-computed-clusters",level:3},{value:"Clustering Algorithm Details",id:"clustering-algorithm-details",level:2},{value:"Algorithm Parameters",id:"algorithm-parameters",level:3},{value:"Customizing Cluster Names",id:"customizing-cluster-names",level:2},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"When to Enable Clustering",id:"when-to-enable-clustering",level:3},{value:"Impact on Performance",id:"impact-on-performance",level:3},{value:"Optimizing Large Datasets",id:"optimizing-large-datasets",level:3},{value:"Adaptive Scales",id:"adaptive-scales",level:2},{value:"Example: Clustering vs No Clustering",id:"example-clustering-vs-no-clustering",level:2}],p={toc:u};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,l.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"clustering"},"Clustering"),(0,a.kt)("p",null,"When visualizing large numbers of locations, flowmap.gl can cluster nearby points together. This improves performance and visual clarity by aggregating locations at different zoom levels."),(0,a.kt)("h2",{id:"how-clustering-works"},"How Clustering Works"),(0,a.kt)("p",null,"flowmap.gl uses a hierarchical clustering algorithm based on ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/mapbox/supercluster"},"supercluster"),". As you zoom out, nearby locations merge into clusters. Flows between clustered locations are aggregated (summed)."),(0,a.kt)("h3",{id:"key-concepts"},"Key Concepts"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Cluster"),": A group of nearby locations treated as a single point"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Cluster Level"),": A zoom level at which clustering is applied"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Cluster Node"),": Either an original location or a cluster containing multiple locations"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Aggregated Flow"),": Flows summed across all locations in connected clusters")),(0,a.kt)("h2",{id:"enabling-clustering"},"Enabling Clustering"),(0,a.kt)("p",null,"Clustering is enabled by default:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"new FlowmapLayer({\n  clusteringEnabled: true,   // Enable clustering (default: true)\n  clusteringAuto: true,      // Automatically adjust level (default: true)\n  // ...\n});\n")),(0,a.kt)("h2",{id:"configuration-options"},"Configuration Options"),(0,a.kt)("h3",{id:"clusteringenabled"},(0,a.kt)("inlineCode",{parentName:"h3"},"clusteringEnabled")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Type: ",(0,a.kt)("inlineCode",{parentName:"li"},"boolean")),(0,a.kt)("li",{parentName:"ul"},"Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"true"))),(0,a.kt)("p",null,"Whether to enable location clustering."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// Disable clustering entirely\nnew FlowmapLayer({\n  clusteringEnabled: false,\n  // ...\n});\n")),(0,a.kt)("h3",{id:"clusteringauto"},(0,a.kt)("inlineCode",{parentName:"h3"},"clusteringAuto")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Type: ",(0,a.kt)("inlineCode",{parentName:"li"},"boolean")),(0,a.kt)("li",{parentName:"ul"},"Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"true"))),(0,a.kt)("p",null,"Whether to automatically select the clustering level based on the current zoom."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// Let the library choose clustering level based on zoom\nnew FlowmapLayer({\n  clusteringEnabled: true,\n  clusteringAuto: true,  // Automatically adjust\n  // ...\n});\n")),(0,a.kt)("h3",{id:"clusteringlevel"},(0,a.kt)("inlineCode",{parentName:"h3"},"clusteringLevel")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Type: ",(0,a.kt)("inlineCode",{parentName:"li"},"number")),(0,a.kt)("li",{parentName:"ul"},"Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"undefined"))),(0,a.kt)("p",null,"Fixed zoom level for clustering. Only used when ",(0,a.kt)("inlineCode",{parentName:"p"},"clusteringAuto")," is ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// Use a fixed clustering level\nnew FlowmapLayer({\n  clusteringEnabled: true,\n  clusteringAuto: false,\n  clusteringLevel: 5,  // Always use zoom level 5 clustering\n  // ...\n});\n")),(0,a.kt)("h2",{id:"cluster-levels-data-structure"},"Cluster Levels Data Structure"),(0,a.kt)("p",null,"For advanced use cases, you can provide pre-computed cluster levels:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"interface ClusterLevel {\n  zoom: number;\n  nodes: ClusterNode[];\n}\n\ninterface ClusterNode {\n  id: string | number;\n  zoom: number;\n  lat: number;\n  lon: number;\n}\n\n// Cluster nodes include children IDs\ninterface Cluster extends ClusterNode {\n  name?: string;\n  children: (string | number)[];  // IDs of child locations/clusters\n}\n")),(0,a.kt)("h3",{id:"example-pre-computed-clusters"},"Example: Pre-computed Clusters"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"const data = {\n  locations: [\n    {id: 'NYC', name: 'New York', lat: 40.7128, lon: -74.0060},\n    {id: 'BOS', name: 'Boston', lat: 42.3601, lon: -71.0589},\n    {id: 'PHL', name: 'Philadelphia', lat: 39.9526, lon: -75.1652},\n    {id: 'LA', name: 'Los Angeles', lat: 34.0522, lon: -118.2437},\n    {id: 'SF', name: 'San Francisco', lat: 37.7749, lon: -122.4194},\n  ],\n  flows: [\n    {origin: 'NYC', dest: 'LA', count: 1000},\n    {origin: 'BOS', dest: 'SF', count: 500},\n    // ...\n  ],\n  clusterLevels: [\n    {\n      zoom: 4,  // Most clustered\n      nodes: [\n        {\n          id: 'east-coast',\n          name: 'East Coast',\n          zoom: 4,\n          lat: 40.5,\n          lon: -73.5,\n          children: ['NYC', 'BOS', 'PHL'],\n        },\n        {\n          id: 'west-coast',\n          name: 'West Coast',\n          zoom: 4,\n          lat: 36.0,\n          lon: -120.0,\n          children: ['LA', 'SF'],\n        },\n      ],\n    },\n    {\n      zoom: 6,  // Less clustered\n      nodes: [\n        {\n          id: 'northeast',\n          name: 'Northeast',\n          zoom: 6,\n          lat: 41.0,\n          lon: -73.0,\n          children: ['NYC', 'BOS'],\n        },\n        {id: 'PHL', name: 'Philadelphia', lat: 39.9526, lon: -75.1652, zoom: 6},\n        {id: 'LA', name: 'Los Angeles', lat: 34.0522, lon: -118.2437, zoom: 6},\n        {id: 'SF', name: 'San Francisco', lat: 37.7749, lon: -122.4194, zoom: 6},\n      ],\n    },\n  ],\n};\n")),(0,a.kt)("h2",{id:"clustering-algorithm-details"},"Clustering Algorithm Details"),(0,a.kt)("p",null,"The built-in clustering algorithm:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Projects locations")," to spherical mercator coordinates"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Builds a KD-tree")," for efficient spatial queries"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Iteratively clusters")," from max zoom down to min zoom"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Weights clusters")," by flow magnitude for positioning"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Aggregates flows")," between cluster members")),(0,a.kt)("h3",{id:"algorithm-parameters"},"Algorithm Parameters"),(0,a.kt)("p",null,"The algorithm uses these internal parameters:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,a.kt)("th",{parentName:"tr",align:null},"Default"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"minZoom"),(0,a.kt)("td",{parentName:"tr",align:null},"0"),(0,a.kt)("td",{parentName:"tr",align:null},"Minimum zoom to generate clusters")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"maxZoom"),(0,a.kt)("td",{parentName:"tr",align:null},"16"),(0,a.kt)("td",{parentName:"tr",align:null},"Maximum zoom level for clustering")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"radius"),(0,a.kt)("td",{parentName:"tr",align:null},"40"),(0,a.kt)("td",{parentName:"tr",align:null},"Cluster radius in pixels")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"extent"),(0,a.kt)("td",{parentName:"tr",align:null},"512"),(0,a.kt)("td",{parentName:"tr",align:null},"Tile extent (radius is relative to this)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"nodeSize"),(0,a.kt)("td",{parentName:"tr",align:null},"64"),(0,a.kt)("td",{parentName:"tr",align:null},"KD-tree leaf node size")))),(0,a.kt)("h2",{id:"customizing-cluster-names"},"Customizing Cluster Names"),(0,a.kt)("p",null,"When providing custom cluster levels, set meaningful names:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"const clusterLevels = [\n  {\n    zoom: 4,\n    nodes: [\n      {\n        id: 'region-1',\n        name: 'US Northeast (3 cities)',  // Descriptive name\n        zoom: 4,\n        lat: 40.5,\n        lon: -73.5,\n        children: ['NYC', 'BOS', 'PHL'],\n      },\n      // ...\n    ],\n  },\n];\n")),(0,a.kt)("p",null,"The cluster name appears in tooltips and picking info."),(0,a.kt)("h2",{id:"performance-considerations"},"Performance Considerations"),(0,a.kt)("h3",{id:"when-to-enable-clustering"},"When to Enable Clustering"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Enable")," for datasets with many (100+) locations"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Enable")," when locations are densely packed in certain areas"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Disable")," when precise individual locations must always be visible")),(0,a.kt)("h3",{id:"impact-on-performance"},"Impact on Performance"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Clustering"),(0,a.kt)("th",{parentName:"tr",align:null},"Performance"),(0,a.kt)("th",{parentName:"tr",align:null},"Visual Clarity"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Enabled"),(0,a.kt)("td",{parentName:"tr",align:null},"Better - fewer elements to render"),(0,a.kt)("td",{parentName:"tr",align:null},"Better at low zooms")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Disabled"),(0,a.kt)("td",{parentName:"tr",align:null},"May slow down with many locations"),(0,a.kt)("td",{parentName:"tr",align:null},"Better at high zooms")))),(0,a.kt)("h3",{id:"optimizing-large-datasets"},"Optimizing Large Datasets"),(0,a.kt)("p",null,"For very large datasets (10,000+ locations):"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Use pre-computed clusters")," to avoid runtime computation"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Set appropriate ",(0,a.kt)("inlineCode",{parentName:"strong"},"maxTopFlowsDisplayNum"))," to limit rendered flows"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Consider using a Web Worker")," (see react-worker-app example)")),(0,a.kt)("h2",{id:"adaptive-scales"},"Adaptive Scales"),(0,a.kt)("p",null,"When ",(0,a.kt)("inlineCode",{parentName:"p"},"adaptiveScalesEnabled: true")," (default), flow thickness and colors adapt to the visible flows at each zoom level:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"new FlowmapLayer({\n  clusteringEnabled: true,\n  adaptiveScalesEnabled: true,  // Scales adjust per zoom\n  // ...\n});\n")),(0,a.kt)("p",null,"This ensures visual variation is maintained even as flows aggregate during clustering."),(0,a.kt)("h2",{id:"example-clustering-vs-no-clustering"},"Example: Clustering vs No Clustering"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// Compare clustering behavior\nconst withClustering = new FlowmapLayer({\n  id: 'with-clustering',\n  data,\n  clusteringEnabled: true,\n  clusteringAuto: true,\n  // ...\n});\n\nconst withoutClustering = new FlowmapLayer({\n  id: 'without-clustering',\n  data,\n  clusteringEnabled: false,\n  // ...\n});\n")))}c.isMDXComponent=!0}}]);